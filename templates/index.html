{% extends "layout.html" %}

{% block head %}
<script src="https://cdn.amcharts.com/lib/5/index.js"></script>
<script src="https://cdn.amcharts.com/lib/5/percent.js"></script>
<script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>
<style>
    #chartdiv {
      width: 100%;
      height: 500px;
    }
    </style>
{% endblock %}

{% block title %}Monthly Spendings{% endblock %}

{% block main %}

    <form action="/" method="post">
        <div class="input-group">
            <select name="month" class="form-select">
                <option disabled selected>Select Month</option>
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
            <select name="year" class="form-select">
                <option disabled selected>Select year</option>
                <option value="{{ year }}">{{ year }}</option>
                <option value="{{ year + 1}}">{{ year + 1 }}</option>
                <option value="{{ year + 2 }}">{{ year + 2 }}</option>
                <option value="{{ year + 3 }}">{{ year + 3 }}</option>
                <option value="{{ year + 4 }}">{{ year + 4 }}</option>
            </select>
            <button class="btn btn-outline-secondary" type="submit">Preview</button>
        </div>
    </form>
    {% if expenses %}
    <div id="chartdiv"></div>
    {% endif %}
{% endblock %}

{% block footer %}
<script>
    am5.ready(function() {
    
    // Define data for each year
    var chartData = {
      "{{ month }}/{{ year }}": [
      { sector: "Transportation", size: "{{ expenses[0] }}" },
      { sector: "Housing", size: "{{ expenses[1] }}"},
      { sector: "Medical/Health", size: "{{ expenses[2] }}" },
      { sector: "Groceries", size: "{{ expenses[3] }}" },
      { sector: "Insurance", size: "{{ expenses[4] }}" },
      { sector: "Shopping", size: "{{ expenses[5] }}" },
      { sector: "Hobbies/Entertainment", size: "{{ expenses[6] }}" },
      { sector: "Others", size: "{{ expenses[7] }}" } ],        
    };
    
    // Create root element
    // https://www.amcharts.com/docs/v5/getting-started/#Root_element
    var root = am5.Root.new("chartdiv");
    
    
    // Set themes
    // https://www.amcharts.com/docs/v5/concepts/themes/
    root.setThemes([
      am5themes_Animated.new(root)
    ]);
    
    
    // Create chart
    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/
    var chart = root.container.children.push(am5percent.PieChart.new(root, {
      innerRadius: 100,
      layout: root.verticalLayout
    }));
    
    
    // Create series
    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Series
    var series = chart.series.push(am5percent.PieSeries.new(root, {
      valueField: "size",
      categoryField: "sector"
    }));
    
    
    // Set data
    // https://www.amcharts.com/docs/v5/charts/percent-charts/pie-chart/#Setting_data
    series.data.setAll([
      { sector: "Transportation", size: 1 },
      { sector: "Housing", size: 1 },
      { sector: "Medical/Health", size: 1 },
      { sector: "Groceries", size: 1 },
      { sector: "Insurance", size: 1 },
      { sector: "Shopping", size: 1 },
      { sector: "Hobbies/Entertainment", size: 1 },
      { sector: "Others", size: 1 }
    ]);
    
    
    // Play initial series animation
    // https://www.amcharts.com/docs/v5/concepts/animations/#Animation_of_series
    series.appear(1000, 100);
    
    
    // Add label
    var label = root.tooltipContainer.children.push(am5.Label.new(root, {
      x: am5.p50,
      y: am5.p50,
      centerX: am5.p50,
      centerY: am5.p50,
      fill: am5.color(0x000000),
      fontSize: 50
    }));
    
    
    // Animate chart data
    //var currentYear = 1995;
    function getCurrentData() {
      //var data = chartData[currentYear];
      //currentYear++;
      //if (currentYear > 2014)
      //  currentYear = 1995;
      var data = chartData["{{ month }}/{{ year }}"]
      return data;
    }
    
    function loop() {
        label.set("text", "{{ month }}/{{ year }}");
        var data = getCurrentData();
        for(var i = 0; i < data.length; i++) {
            series.data.setIndex(i, data[i]);
        }
        //chart.setTimeout( loop, 4000 );
    }
    
    loop()
    
    }); // end am5.ready()
    </script>
    
{% endblock %}
